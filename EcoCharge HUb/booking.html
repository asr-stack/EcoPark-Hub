<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>EcoCharge Hub – Booking</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="wrapper">
    <!-- Header / Navigation -->
    <header class="header">
      <nav class="nav">
        <div class="logo">
          <div class="logo-icon"></div>
          <div>
            <div class="logo-text-main">EcoCharge Hub</div>
            <div class="logo-text-sub">Smart EV Parking</div>
          </div>
        </div>
        <div class="nav-links">
          <a href="index.html">About</a>
          <a href="booking.html" class="active">Booking</a>
          <a href="energy.html">Energy</a>
          <a href="contact.html">Contact</a>
        </div>
      </nav>
    </header>

    <main class="main">
      <section class="section fade-in-up">
        <h2 class="section-title">Book your parking slot</h2>
        <p class="section-subtitle">
          Tap on a <strong>green</strong> slot to reserve it. You’ll enter your email and receive
          a one‑time password (OTP) on screen. When you want to leave, tap the <strong>red</strong>
          slot again and unlock it with the same OTP.
        </p>

        <div class="parking-layout" id="parkingLayout">
          <!-- Example slots in blocks A, B and C -->
          <div class="slot available" data-slot-id="A1">
            <div class="slot-pill">A1</div>
            <div class="slot-label">Block A – 01</div>
            <div class="slot-status">Available</div>
          </div>
          <div class="slot available" data-slot-id="A2">
            <div class="slot-pill">A2</div>
            <div class="slot-label">Block A – 02</div>
            <div class="slot-status">Available</div>
          </div>
          <div class="slot available" data-slot-id="A3">
            <div class="slot-pill">A3</div>
            <div class="slot-label">Block A – 03</div>
            <div class="slot-status">Available</div>
          </div>

          <div class="slot available" data-slot-id="B1">
            <div class="slot-pill">B1</div>
            <div class="slot-label">Block B – 01</div>
            <div class="slot-status">Available</div>
          </div>
          <div class="slot available" data-slot-id="B2">
            <div class="slot-pill">B2</div>
            <div class="slot-label">Block B – 02</div>
            <div class="slot-status">Available</div>
          </div>
          <div class="slot available" data-slot-id="B3">
            <div class="slot-pill">B3</div>
            <div class="slot-label">Block B – 03</div>
            <div class="slot-status">Available</div>
          </div>

          <div class="slot available" data-slot-id="C1">
            <div class="slot-pill">C1</div>
            <div class="slot-label">Block C – 01</div>
            <div class="slot-status">Available</div>
          </div>
          <div class="slot available" data-slot-id="C2">
            <div class="slot-pill">C2</div>
            <div class="slot-label">Block C – 02</div>
            <div class="slot-status">Available</div>
          </div>
          <div class="slot available" data-slot-id="C3">
            <div class="slot-pill">C3</div>
            <div class="slot-label">Block C – 03</div>
            <div class="slot-status">Available</div>
          </div>
        </div>

        <div class="legend">
          <div class="legend-item">
            <span class="legend-color green"></span> Free slot (tap to book)
          </div>
          <div class="legend-item">
            <span class="legend-color red"></span> In use (tap to unlock with OTP)
          </div>
        </div>
      </section>
    </main>

    <footer class="footer">
      © <span id="year"></span> EcoCharge Hub. Booking experience.
    </footer>
  </div>

  <!-- Booking Modal -->
  <div class="modal-backdrop" id="bookingModalBackdrop">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Reserve slot <span id="modalSlotId"></span></h3>
        <button class="modal-close" id="bookingModalClose">&times;</button>
      </div>
      <div class="modal-body">
        <form id="bookingForm">
          <div class="form-group">
            <label class="form-label" for="emailInput">Your email address</label>
            <input
              type="email"
              id="emailInput"
              class="input"
              placeholder="you@example.com"
              required
            />
          </div>
          <button type="submit" class="btn btn-primary">Generate OTP &amp; Book</button>
          <div class="modal-note">
            The OTP is stored only on this browser as a demo. In a real system, it would also be
            sent to your email or phone.
          </div>
          <div class="modal-otp-display" id="otpDisplay" style="display: none;"></div>
        </form>
      </div>
    </div>
  </div>

  <!-- Unlock Modal -->
  <div class="modal-backdrop" id="unlockModalBackdrop">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Unlock slot <span id="unlockSlotId"></span></h3>
        <button class="modal-close" id="unlockModalClose">&times;</button>
      </div>
      <div class="modal-body">
        <form id="unlockForm">
          <div class="form-group">
            <label class="form-label" for="otpInput">Enter your OTP</label>
            <input
              type="text"
              id="otpInput"
              class="input"
              maxlength="6"
              placeholder="e.g. 482193"
              required
            />
          </div>
          <button type="submit" class="btn btn-primary">Unlock &amp; Free Slot</button>
          <div class="modal-note">
            Once verified, the slot will be released and shown as available again.
          </div>
          <div class="modal-otp-display" id="unlockStatus" style="display: none;"></div>
        </form>
      </div>
    </div>
  </div>

  <script>
    // ---- Shared footer year ----
    document.getElementById("year").textContent = new Date().getFullYear();

    // ---- Simple booking state using localStorage ----
    const SLOT_KEY_PREFIX = "ecocharge_slot_";

    function getSlotState(id) {
      const raw = localStorage.getItem(SLOT_KEY_PREFIX + id);
      return raw ? JSON.parse(raw) : null;
    }

    function setSlotState(id, data) {
      localStorage.setItem(SLOT_KEY_PREFIX + id, JSON.stringify(data));
    }

    function clearSlotState(id) {
      localStorage.removeItem(SLOT_KEY_PREFIX + id);
    }

    function refreshSlotsFromStorage() {
      document.querySelectorAll(".slot").forEach((slot) => {
        const id = slot.dataset.slotId;
        const state = getSlotState(id);
        const statusEl = slot.querySelector(".slot-status");
        if (state && state.occupied) {
          slot.classList.remove("available");
          slot.classList.add("occupied");
          statusEl.textContent = "In use – tap to unlock";
          slot.style.borderColor = "rgba(248, 113, 113, 0.7)";
          slot.querySelector(".slot-pill").style.background = "rgba(248, 113, 113, 0.12)";
          slot.querySelector(".slot-pill").style.borderColor = "rgba(248, 113, 113, 0.65)";
          slot.querySelector(".slot-pill").style.color = "#fecaca";
        } else {
          slot.classList.remove("occupied");
          slot.classList.add("available");
          statusEl.textContent = "Available";
          slot.style.borderColor = "rgba(34, 197, 94, 0.6)";
          slot.querySelector(".slot-pill").style.background = "rgba(34, 197, 94, 0.12)";
          slot.querySelector(".slot-pill").style.borderColor = "rgba(34, 197, 94, 0.7)";
          slot.querySelector(".slot-pill").style.color = "#bbf7d0";
        }
      });
    }

    // ---- Booking modal logic ----
    const bookingModalBackdrop = document.getElementById("bookingModalBackdrop");
    const modalSlotId = document.getElementById("modalSlotId");
    const bookingForm = document.getElementById("bookingForm");
    const otpDisplay = document.getElementById("otpDisplay");
    let currentBookingSlotId = null;

    function openBookingModal(slotId) {
      currentBookingSlotId = slotId;
      modalSlotId.textContent = slotId;
      otpDisplay.style.display = "none";
      otpDisplay.textContent = "";
      bookingForm.reset();
      bookingModalBackdrop.style.display = "flex";
    }

    function closeBookingModal() {
      bookingModalBackdrop.style.display = "none";
      currentBookingSlotId = null;
    }

    document.getElementById("bookingModalClose").addEventListener("click", closeBookingModal);
    bookingModalBackdrop.addEventListener("click", (e) => {
      if (e.target === bookingModalBackdrop) closeBookingModal();
    });

    bookingForm.addEventListener("submit", (e) => {
      e.preventDefault();
      if (!currentBookingSlotId) return;

      const email = document.getElementById("emailInput").value.trim();
      if (!email) return;

      // Generate a 6-digit pseudo OTP
      const otp = Math.floor(100000 + Math.random() * 900000).toString();
      setSlotState(currentBookingSlotId, {
        email,
        otp,
        occupied: true,
        bookedAt: new Date().toISOString(),
      });

      otpDisplay.style.display = "block";
      otpDisplay.textContent =
        "Your one-time password for slot " +
        currentBookingSlotId +
        " is: " +
        otp +
        ". Please keep it safe – you'll need it to unlock your car.";

      refreshSlotsFromStorage();
    });

    // ---- Unlock modal logic ----
    const unlockModalBackdrop = document.getElementById("unlockModalBackdrop");
    const unlockSlotIdSpan = document.getElementById("unlockSlotId");
    const unlockForm = document.getElementById("unlockForm");
    const unlockStatus = document.getElementById("unlockStatus");
    let currentUnlockSlotId = null;

    function openUnlockModal(slotId) {
      currentUnlockSlotId = slotId;
      unlockSlotIdSpan.textContent = slotId;
      unlockForm.reset();
      unlockStatus.style.display = "none";
      unlockStatus.textContent = "";
      unlockModalBackdrop.style.display = "flex";
    }

    function closeUnlockModal() {
      unlockModalBackdrop.style.display = "none";
      currentUnlockSlotId = null;
    }

    document.getElementById("unlockModalClose").addEventListener("click", closeUnlockModal);
    unlockModalBackdrop.addEventListener("click", (e) => {
      if (e.target === unlockModalBackdrop) closeUnlockModal();
    });

    unlockForm.addEventListener("submit", (e) => {
      e.preventDefault();
      if (!currentUnlockSlotId) return;

      const inputOtp = document.getElementById("otpInput").value.trim();
      const state = getSlotState(currentUnlockSlotId);

      if (state && state.otp === inputOtp) {
        clearSlotState(currentUnlockSlotId);
        refreshSlotsFromStorage();
        unlockStatus.style.display = "block";
        unlockStatus.style.color = "#bbf7d0";
        unlockStatus.textContent =
          "OTP verified. Slot has been released – thank you for using EcoCharge Hub!";
        setTimeout(closeUnlockModal, 1100);
      } else {
        unlockStatus.style.display = "block";
        unlockStatus.style.color = "#fecaca";
        unlockStatus.textContent =
          "Incorrect OTP. Please check the code you received when you booked this slot.";
      }
    });

    // ---- Slot click behavior ----
    document.querySelectorAll(".slot").forEach((slot) => {
      slot.addEventListener("click", () => {
        const id = slot.dataset.slotId;
        const state = getSlotState(id);
        if (state && state.occupied) {
          openUnlockModal(id);
        } else {
          openBookingModal(id);
        }
      });
    });

    // Initialize view from storage
    refreshSlotsFromStorage();
  </script>
</body>
</html>